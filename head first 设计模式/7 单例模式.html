<html>
<head>
  <title>7 单例模式</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600646 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3412"/>
<h1>7 单例模式</h1>

<div>
<span><div><div><span style="font-weight: bold;">单例模式</span></div><div>确保一个类只有一个实例，并提供一个全局访问点</div><div><br/></div><div style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre;"><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(117, 113, 94); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">// 单例模式</span></div><div style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre;"><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">public</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">class</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(166, 226, 46); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px; text-decoration: underline;">Singleton</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">{</span></div><div style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre;"><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">    </span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">private</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">static</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(102, 217, 239); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px; font-style: italic;">Singleton</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">uniqueInstance</span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">;</span></div><div style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre;"><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(117, 113, 94); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">    </span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(117, 113, 94); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">// 其他变量</span></div><div style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre;"><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">    </span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">private</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(166, 226, 46); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">Singleton</span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">() {}</span></div><div style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre;"><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">    </span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">public</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">static</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(102, 217, 239); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px; font-style: italic;">Singleton</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(166, 226, 46); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">getInstance</span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">() {</span></div><div style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre;"><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">    </span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">    </span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">if</span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">(uniqueInstance</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">==</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(174, 129, 255); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">null</span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">) {</span></div><div style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre;"><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">    </span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">    </span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">    </span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">uniqueInstance</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">=</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">new</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(166, 226, 46); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">Singleton</span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">();</span></div><div style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre;"><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">    </span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">    </span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">}</span></div><div style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre;"><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">    </span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(249, 38, 114); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">return</span> <span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">uniqueInstance;</span></div><div style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre;"><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">    </span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">}</span></div><div style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre;"><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(117, 113, 94); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">    </span><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(117, 113, 94); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">// 其他方法</span></div><div style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre;"><span style="background-color: rgb(39, 40, 34); font-size: 14px; white-space: pre; color: rgb(248, 248, 242); font-family: Consolas, &quot;Courier New&quot;, monospace; line-height: 19px;">}</span></div><div><br/></div><div>上述代码的问题：多线程（显然js就没有这个问题了）</div><div><img src="7 单例模式_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>解决办法：同步getInstance（添加synchronized关键字）</div><div>新的问题：其实只有第一次执行时需要同步，可能会拖垮性能</div><div>解决办法</div><ul><li><div>如果对性能无影响，就说明都不用做</div></li><li><div>使用急切创建实例</div></li></ul><div>    <img src="7 单例模式_files/Image [1].png" type="image/png" data-filename="Image.png" width="530"/></div><ul><li><div>双重检查加锁</div></li></ul><div>    <img src="7 单例模式_files/Image [2].png" type="image/png" data-filename="Image.png" width="545"/></div><div><img src="7 单例模式_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><img src="7 单例模式_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div><img src="7 单例模式_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 